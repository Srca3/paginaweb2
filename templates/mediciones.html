<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mediciones en Tiempo Real</title>
    <link rel="stylesheet" href="static/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>

    <header>
        <h1>Mediciones en Tiempo Real</h1>
        <nav>
            <ul>
                <li><a href="/">Inicio</a></li>
                <li><a href="/acerca">Acerca de</a></li>
                <li><a href="/contacto">Contacto</a></li>
                <li><a href="/mediciones">Mediciones en Tiempo Real</a></li>
                <li><a href="/descargas">Descargas</a></li>
            </ul>
        </nav>
    </header>


    <section class="main-content">
        <h2>Visualización de Datos en Tiempo Real</h2>
        <p>Aquí encontrarás gráficos y datos meteorológicos en tiempo real.</p>
        <!-- Contenedor para los gráficos -->
        <div class="graph-container">
            <!-- Gráfico para la lluvia -->
            <svg id="rainChart" width="300" height="150"></svg>

            <!-- Gráfico para la radiación UV -->
            <svg id="uvChart" width="300" height="150"></svg>

            <!-- Gráfico para la temperatura -->
            <svg id="temperatureChart" width="300" height="150"></svg>

            <!-- Gráfico para la humedad -->
            <svg id="humidityChart" width="300" height="150"></svg>
        </div>
    </section>

    <footer>
        <p>&copy; 2023 EcoClimateHubUDEP</p>
    </footer>

    <script>
        // Function to create/update charts using D3.js
        function updateChartsD3(data, chartId, color) {
            const margin = { top: 10, right: 30, bottom: 30, left: 60 };
            const width = 300 - margin.left - margin.right;
            const height = 150 - margin.top - margin.bottom;

            const svg = d3.select(`#${chartId}`)
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleTime()
                .domain(d3.extent(data, d => new Date(d[1])))
                .range([0, width]);

            const y = d3.scaleLinear()
                .domain([0, d3.max(data, d => d[2])])
                .range([height, 0]);

            const line = d3.line()
                .x(d => x(new Date(d[1])))
                .y(d => y(d[2]));

            svg.append("path")
                .datum(data)
                .attr("fill", "none")
                .attr("stroke", color)
                .attr("stroke-width", 1.5)
                .attr("d", line);

            svg.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x));

            svg.append("g")
                .call(d3.axisLeft(y));
        }

        // Fetch data and update charts using D3.js
        function updateCharts() {
            fetch('/data')
                .then(response => response.json())
                .then(data => {
                    // Update charts for each type of data
                    updateChartsD3(data, 'rainChart', 'rgba(75, 192, 192, 1)');
                    updateChartsD3(data, 'uvChart', 'rgba(255, 99, 132, 1)');
                    updateChartsD3(data, 'temperatureChart', 'rgba(255, 150, 79, 1)');
                    updateChartsD3(data, 'humidityChart', 'rgba(119, 221, 119, 1)');
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // Call the updateCharts function on page load
        updateCharts();

        // Update charts every 5 seconds (adjust as needed)
        setInterval(updateCharts, 5000);
    </script>

</body>

</html>
